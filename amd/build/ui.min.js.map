{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Script ui.js\n *\n * Contains all logic for the modal\n * - Insert form (opening repo, settings for object, inserting into editor)\n * - Edit form (changing settings, detecting, handling and converting old atto objects)\n *\n * On edit, old atto es objects will be converted to the format used by tinyMCE in order to ensure backwards\n * compatibility. Subsequently, they can no longer be edited using atto.\n *\n * @module      tiny_edusharing/ui\n * @copyright   2024 metaVentis GmbH <http://metaventis.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {component} from './common';\nimport {getCourseId, getRepoTarget, getRepoUrl} from './options';\n\nimport {renderForPromise} from 'core/templates';\nimport Modal from 'tiny_edusharing/modal';\nimport ModalEvents from 'core/modal_events';\nimport ModalFactory from 'core/modal_factory';\nimport {getTicket} from \"./repository\";\nimport Config from 'core/config';\n\nlet openingSelection = null;\n\nexport const handleAction = (editor) => {\n    openingSelection = editor.selection.getBookmark();\n    displayDialogue(editor);\n};\n\nexport const initInstructionGif = () => {\n    const gif = window.document.getElementById('eduInstructionGif');\n    if (gif === null) {\n        return;\n    }\n    const relativePath = gif.getAttribute('src');\n    const absolutePath = Config.wwwroot + relativePath;\n    gif.setAttribute('src', absolutePath);\n};\n\nconst handleInsertSubmission = async(editor) => {\n    const nodeJson = window.document.getElementById('edusharing_node').value;\n    const node = JSON.parse(nodeJson);\n    const version = window.document.querySelector('input[name=\"eduVersion\"]:checked').value;\n    const caption = window.document.getElementById('captionInput').value;\n    const alignment = window.document.querySelector('input[name=\"eduAlignment\"]:checked').value;\n    let width;\n    let height;\n    if (window.document.getElementById('edusharingNoWidth').value === \"true\") {\n        const previewHeight = window.document.getElementById('eduPreviewImage').height;\n        const previewWidth = window.document.getElementById('eduPreviewImage').width;\n        const ratio = previewWidth / previewHeight;\n        width = 400;\n        height = 400 / ratio;\n    } else {\n        width = window.document.getElementById('eduWidth').value;\n        height = checkIfHeightApplicable(node.mediatype) ?\n            window.document.getElementById('eduHeight').value : \"auto\";\n    }\n    let style = '';\n    if (alignment !== 'none') {\n        style = 'float:' + alignment + ';';\n    }\n    if (node.mediatype === 'folder') {\n        style = 'display:block;';\n    }\n\n    let title = node.title || node.name;\n\n    let url = new URL(node.previewUrl);\n    url.searchParams.set('caption', caption);\n    url.searchParams.set('object_url', node.objectUrl);\n    url.searchParams.set('mediatype', node.mediatype);\n    url.searchParams.set('mimetype', node.mimetype);\n    url.searchParams.set('window_version', version);\n    url.searchParams.set('title', title);\n\n    let img = false;\n    let ref = false;\n\n    if (node.mediatype === 'ref') {\n        ref = true;\n    } else {\n        img = true;\n        url.searchParams.set('width', width.toString());\n        url.searchParams.set('height', height.toString());\n    }\n\n    const content = await renderForPromise(`${component}/content`, {\n        edusharingImg: img,\n        edusharingRef: ref,\n        edusharingPreviewSrc: url.toString(),\n        edusharingTitle: title.toString(),\n        edusharingInsertCaption: caption.toString() !== \"\",\n        edusharingCaption: caption.toString(),\n        edusharingWidth: width.toString(),\n        edusharingHeight: height.toString(),\n        edusharingStyle: style,\n        dataEdited: false\n    });\n\n    editor.selection.moveToBookmark(openingSelection);\n    editor.execCommand('mceInsertContent', false, content.html);\n    editor.selection.moveToBookmark(openingSelection);\n};\n\nconst displayDialogue = async(editor) => {\n    const prepareEditModal = () => {\n        const addEditSubmitHandler = () => {\n            $root.on(ModalEvents.save, () => {\n                const newCaption = window.document.getElementById('captionInput').value;\n                const inputAlignment = window.document.querySelector('input[name=\"eduAlignment\"]:checked').value;\n                const hasAlignmentChanged = inputAlignment !== alignment;\n                const inputWidth = parseInt(window.document.getElementById('eduWidth').value);\n                const inputHeight = parseInt(window.document.getElementById('eduHeight').value);\n                let hasSizeChanged = inputHeight !== height || inputWidth !== width;\n                if (isSizeEditable && hasSizeChanged) {\n                    url.searchParams.set('width', inputWidth);\n                    url.searchParams.set('height', inputHeight);\n                }\n                if (!isOldAttoElement) {\n                    if (existingCaption === null && newCaption !== \"\") {\n                        const newCaptionParagraph = document.createElement('p');\n                        newCaptionParagraph.classList.add('edusharing_caption');\n                        newCaptionParagraph.innerHTML = newCaption;\n                        currentEdusharing.appendChild(newCaptionParagraph);\n                    } else if (existingCaption !== null && newCaption !== \"\") {\n                        existingCaptionParagraph.remove();\n                    } else if (existingCaption !== null) {\n                        existingCaption.innerHTML = newCaption;\n                    }\n                    if (hasAlignmentChanged) {\n                        if (inputAlignment === 'none') {\n                            currentEdusharing.style.removeProperty('float');\n                            currentEdusharing.setAttribute('data-mce-style', \"\");\n                        } else {\n                            currentEdusharing.style.float = inputAlignment;\n                            currentEdusharing.setAttribute('data-mce-style', 'float: ' + inputAlignment + ';');\n                        }\n                    }\n                    if (isSizeEditable && hasSizeChanged) {\n                        eduImage.setAttribute('width', inputWidth);\n                        eduImage.setAttribute('height', inputHeight);\n                    }\n                    if (hasAlignmentChanged || hasSizeChanged) {\n                        eduImage.setAttribute('src', url.toString());\n                        eduImage.setAttribute('data-edited', 1);\n                    }\n                } else {\n                    let style = '';\n                    if (inputAlignment !== 'none') {\n                        style = 'float:' + inputAlignment + ';';\n                    }\n                    if (url.searchParams.get('mediatype') === 'folder') {\n                        style = 'display:block;';\n                    }\n                    renderForPromise(`${component}/content`, {\n                        edusharingImg: true,\n                        edusharingRef: false,\n                        edusharingPreviewSrc: url.toString(),\n                        edusharingTitle: url.searchParams.get('title'),\n                        edusharingInsertCaption: window.document.getElementById('captionInput').value !== \"\",\n                        edusharingCaption: window.document.getElementById('captionInput').value,\n                        edusharingWidth: inputWidth.toString(),\n                        edusharingHeight: inputHeight.toString(),\n                        edusharingStyle: style,\n                        dataEdited: hasAlignmentChanged || hasSizeChanged\n                    }).then(result => {\n                        currentEdusharing.remove();\n                        if (paragraphToRemove !== null) {\n                            paragraphToRemove.remove();\n                            const nextParagraph = paragraphToRemove.nextSibling;\n                            if (nextParagraph !== null && nextParagraph.nodeName === 'P'\n                                && nextParagraph.hasChildNodes() && nextParagraph.firstChild.nodeName === 'BR'\n                                && nextParagraph.innerText === \"\") {\n                                nextParagraph.remove();\n                            }\n                        }\n                        editor.selection.moveToBookmark(openingSelection);\n                        editor.insertContent(result.html);\n                        editor.selection.moveToBookmark(openingSelection);\n                        return false;\n                    }).catch(error => window.console.log(error));\n                }\n            });\n        };\n        let existingCaption = null;\n        const nodeOptionsForm = window.document.getElementById('nodeOptionsForm');\n        const existingCaptionParagraph = currentEdusharing.querySelector('.edusharing_caption');\n        let paragraphToRemove = null;\n        if (isOldAttoElement) {\n            const nextSibling = currentEdusharing.nextSibling;\n            if (nextSibling !== null && nextSibling.nodeName === 'P' && nextSibling.innerText.trim() !== \"\") {\n                window.document.getElementById('eduCaptionText').innerHTML = nextSibling.innerText;\n                window.document.getElementById('eduAttoCaptionPrompt').classList.remove('d-none');\n                window.document.getElementById('eduCaptionContinueButton').classList.remove('d-none');\n                window.document.getElementById('eduSubmitButton').classList.add('d-none');\n                nodeOptionsForm.classList.add('d-none');\n                window.document.getElementById('eduCaptionContinueButton').addEventListener(\"click\", () => {\n                    const useExistingCaption = window.document.querySelector('input[name=\"eduCaption\"]:checked').value === '0';\n                    paragraphToRemove = useExistingCaption ? nextSibling : null;\n                    if (useExistingCaption) {\n                        window.document.getElementById('captionInput').value = nextSibling.innerText;\n                        existingCaption = nextSibling.innerText;\n                    }\n                    nodeOptionsForm.classList.remove('d-none');\n                    window.document.getElementById('eduAttoCaptionPrompt').classList.add('d-none');\n                    window.document.getElementById('eduCaptionContinueButton').classList.add('d-none');\n                    window.document.getElementById('eduSubmitButton').classList.remove('d-none');\n                });\n            } else {\n                nodeOptionsForm.classList.remove('d-none');\n            }\n        } else {\n            if (existingCaptionParagraph !== null) {\n                window.document.getElementById('captionInput').value = existingCaptionParagraph.innerHTML;\n                existingCaption = existingCaptionParagraph.innerHTML;\n            }\n            nodeOptionsForm.classList.remove('d-none');\n        }\n        const submitButton = window.document.getElementById('eduSubmitButton');\n        submitButton.disabled = false;\n        submitButton.innerHTML = submitButton.getAttribute('data-secondary-title');\n        let isSizeEditable = true;\n        const modalTitle = root.querySelector('.modal-title');\n        modalTitle.innerHTML = modalTitle.querySelector('input').value;\n        window.document.getElementById('repoButtonContainer').classList.add('d-none');\n        const eduImage = currentEdusharing.querySelector(\"img.edusharing_atto\");\n        if (eduImage === null || eduImage === undefined) {\n            root.querySelector('.mform').classList.add('d-none');\n            root.getElementById('eduNoEditInfo').classList.remove('d-none');\n            root.getElementById('eduSubmitButton').classList.add('d-none');\n            return;\n        }\n        const objectUrl = eduImage.getAttribute('src');\n        window.document.getElementById('eduPreviewImage').setAttribute('src', objectUrl);\n        let url = new URL(objectUrl);\n        const mediaType = url.searchParams.get('mediatype');\n        let width = 400;\n        let height = 600;\n        if (!hideSizeOptions(mediaType)) {\n            width = parseInt(eduImage.getAttribute('width') ?? 400);\n            height = parseInt(eduImage.getAttribute('height') ?? 600);\n            initSizeCalculation(width, height);\n            hideHeightInput(mediaType);\n        } else {\n            isSizeEditable = false;\n        }\n        window.document.getElementById(\"objectVersioningContainer\").classList.add('d-none');\n        window.document.getElementById('eduContentTitle').innerHTML = url.searchParams.get('title');\n        let alignment = currentEdusharing.style.float === \"\" ? 'none' : currentEdusharing.style.float;\n        if (alignment === \"none\" && isOldAttoElement) {\n            alignment = currentEdusharing.style.textAlign === \"\" ? 'none' : currentEdusharing.style.textAlign;\n        }\n        if (alignment !== 'none') {\n            window.document.getElementById('eduAlignment' + (alignment === 'right' ? '2' : '1')).checked = true;\n        }\n        addEditSubmitHandler();\n    };\n    const prepareInsertModal = () => {\n        root.addEventListener('click', (e) => {\n            const openRepoButton = e.target.closest('[data-target=\"edusharing\"]');\n            if (openRepoButton) {\n                const repoUrl = getRepoUrl(editor);\n                openRepo(repoUrl, getRepoTarget(editor), getCourseId(editor));\n                window.addEventListener(\"message\", applyNodeListener);\n            }\n        });\n        const applyNodeListener = event => {\n            if (event.data.event === \"APPLY_NODE\") {\n                const node = event.data.data;\n                const previewImage = window.document.getElementById('eduPreviewImage');\n                window.win.close();\n                checkVersioning(node);\n                window.document.getElementById('repoButtonContainer').classList.add('d-none');\n                window.document.getElementById('nodeOptionsForm').classList.remove('d-none');\n                window.document.getElementById('eduContentTitle').innerHTML = node.name ?? node.title;\n                previewImage.setAttribute('src', node.preview.url);\n                if (hideSizeOptions(node.mediatype)) {\n                    window.document.getElementById('edusharingNoWidth').value = \"true\";\n                } else {\n                    const width = node.properties['ccm:width'] !== undefined ? Math.round(node.properties['ccm:width'][0]) : 400;\n                    const height = node.properties['ccm:height'] !== undefined ? Math.round(node.properties['ccm:height'][0]) : 600;\n                    initSizeCalculation(width, height);\n                    hideHeightInput(node.mediatype);\n                }\n                hideCaptionInput(node.mediatype);\n                setNodeData(node);\n                window.document.getElementById('eduSubmitButton').disabled = false;\n            }\n        };\n    };\n    const selection = editor.selection.getNode();\n    let currentEdusharing = selection.closest('.edusharing-placeholder');\n    let isOldAttoElement = false;\n    if (currentEdusharing === null) {\n        if (selection.nodeName === 'IMG' && selection.classList.contains('edusharing_atto')) {\n            const parent = selection.parentNode;\n            if (parent.nodeName === 'P') {\n                currentEdusharing = parent;\n                isOldAttoElement = true;\n            }\n        } else if (selection.nodeName === 'P') {\n            const firstChild = selection.firstChild;\n            if (firstChild.nodeName === 'IMG' && firstChild.classList.contains('edusharing_atto')) {\n                currentEdusharing = selection;\n                isOldAttoElement = true;\n            }\n        }\n    }\n    const isEditMode = currentEdusharing !== null;\n    const modal = await ModalFactory.create({\n        type: Modal.TYPE,\n        large: true,\n        removeOnClose: true\n    });\n    modal.show();\n    const $root = modal.getRoot();\n    const root = $root[0];\n    if (isEditMode) {\n        prepareEditModal();\n    } else {\n        prepareInsertModal();\n        $root.on(ModalEvents.save, () => {\n            handleInsertSubmission(editor);\n        });\n    }\n};\n\nconst hideSizeOptions = mediaType => {\n    const mediaTypesWithoutSizeChoice = ['file-word', 'file-pdf', 'file-odt', 'file-audio', 'file-pdf', 'link'];\n    if (mediaTypesWithoutSizeChoice.includes(mediaType)) {\n        window.document.getElementById('eduWidthContainer').classList.add('d-none');\n        return true;\n    }\n    return false;\n};\n\nconst hideHeightInput = mediaType => {\n    if (!checkIfHeightApplicable(mediaType)) {\n        const heightInput = window.document.getElementById('eduHeight');\n        heightInput.classList.add('d-none');\n        if (heightInput.labels) {\n            heightInput.labels.forEach(label => label.classList.add('d-none'));\n        }\n    }\n};\n\nconst checkIfHeightApplicable = mediaType => mediaType !== \"file-video\";\n\nconst hideCaptionInput = mediaType => {\n    if (mediaType === \"ref\") {\n        window.document.getElementById(\"eduCaptionContainer\").classList.add('d-none');\n    }\n};\n\nconst initSizeCalculation = (width, height) => {\n    if (width === 0 || height === 0) {\n        return;\n    }\n    const aspectRatio = width / height;\n    const heightInput = window.document.getElementById('eduHeight');\n    const widthInput = window.document.getElementById('eduWidth');\n    widthInput.value = width;\n    heightInput.value = height;\n    widthInput.addEventListener('keyup', event => recalculateDimensions(event));\n    widthInput.addEventListener('change', event => recalculateDimensions(event));\n    heightInput.addEventListener('keyup', event => recalculateDimensions(event));\n    heightInput.addEventListener('change', event => recalculateDimensions(event));\n    const recalculateDimensions = (event) => {\n        if (event.target.id === 'eduHeight') {\n            widthInput.value = Math.round(heightInput.value * aspectRatio);\n        } else {\n            heightInput.value = Math.round(widthInput.value / aspectRatio);\n        }\n    };\n};\n\nconst checkVersioning = (node) => {\n    const hasVersion = node.properties['cclom:version'] !== undefined;\n    if (node.aspects.includes('ccm:published') || node.aspects.includes('ccm:collection_io_reference') || !hasVersion) {\n        window.document.querySelectorAll(\".eduVersionRadio\")\n            .forEach(item => item.classList.add('d-none'));\n    }\n    if (hasVersion) {\n        window.document.getElementById('eduversion2').value = node.properties['cclom:version'][0];\n    }\n};\n\nconst setNodeData = node => {\n    const nodeData = {\n        mimetype: node.mimetype,\n        mediatype: node.mediatype,\n        title: node.title,\n        objectUrl: node.objectUrl,\n        name: node.name,\n        previewUrl: node.preview.url\n    };\n    window.document.getElementById('edusharing_node').value = JSON.stringify(nodeData);\n};\n\nconst openRepo = (repoUrl, repoTarget, courseId) => {\n    window.win = window.open();\n    window.win.document.write('Loading edu-sharing ticket...');\n    switch (repoTarget) {\n        case 'collections':\n            repoTarget = '/components/collections';\n            break;\n        case 'workspace':\n            repoTarget = '/components/workspace/files';\n            break;\n        default:\n            repoTarget = '/components/search';\n    }\n    const ajaxParams = {\n        eduTicketStructure: {\n            courseId: courseId\n        }\n    };\n    getTicket(ajaxParams)\n        .then(response => {\n            repoUrl += repoTarget + '?reurl=WINDOW&applyDirectories=true&ticket=' + response.ticket;\n            window.win.location.href = repoUrl;\n            return null;\n        })\n        .fail(() => window.document.write('Error loading ticket.'));\n};\n"],"names":["openingSelection","editor","selection","getBookmark","displayDialogue","gif","window","document","getElementById","relativePath","getAttribute","absolutePath","Config","wwwroot","setAttribute","async","getNode","currentEdusharing","closest","isOldAttoElement","nodeName","classList","contains","parent","parentNode","firstChild","isEditMode","modal","ModalFactory","create","type","Modal","TYPE","large","removeOnClose","show","$root","getRoot","root","existingCaption","nodeOptionsForm","existingCaptionParagraph","querySelector","paragraphToRemove","nextSibling","innerText","trim","innerHTML","remove","add","addEventListener","useExistingCaption","value","submitButton","disabled","isSizeEditable","modalTitle","eduImage","objectUrl","url","URL","mediaType","searchParams","get","width","height","hideSizeOptions","parseInt","initSizeCalculation","hideHeightInput","alignment","style","float","textAlign","checked","on","ModalEvents","save","newCaption","inputAlignment","hasAlignmentChanged","inputWidth","inputHeight","hasSizeChanged","set","component","edusharingImg","edusharingRef","edusharingPreviewSrc","toString","edusharingTitle","edusharingInsertCaption","edusharingCaption","edusharingWidth","edusharingHeight","edusharingStyle","dataEdited","then","result","nextParagraph","hasChildNodes","moveToBookmark","insertContent","html","catch","error","console","log","newCaptionParagraph","createElement","appendChild","removeProperty","prepareEditModal","e","target","repoUrl","openRepo","applyNodeListener","event","data","node","previewImage","win","close","checkVersioning","name","title","preview","mediatype","undefined","properties","Math","round","hideCaptionInput","setNodeData","prepareInsertModal","nodeJson","JSON","parse","version","caption","previewHeight","checkIfHeightApplicable","previewUrl","mimetype","img","ref","content","execCommand","handleInsertSubmission","includes","heightInput","labels","forEach","label","aspectRatio","widthInput","recalculateDimensions","id","hasVersion","aspects","querySelectorAll","item","nodeData","stringify","repoTarget","courseId","open","write","ajaxParams","eduTicketStructure","response","ticket","location","href","fail"],"mappings":"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"}