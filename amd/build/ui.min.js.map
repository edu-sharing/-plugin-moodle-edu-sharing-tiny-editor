{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny edu-sharing Content configuration.\n *\n * @module      tiny_edusharing/commands\n * @copyright   2022 metaVentis GmbH <http://metaventis.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {component} from './common';\nimport {getCourseId, getRepoTarget, getRepoUrl} from './options';\n\nimport {renderForPromise} from 'core/templates';\nimport Modal from 'tiny_edusharing/modal';\nimport ModalEvents from 'core/modal_events';\nimport ModalFactory from 'core/modal_factory';\nimport {getTicket} from \"./repository\";\nimport Config from 'core/config';\n\nlet openingSelection = null;\n\nexport const handleAction = (editor) => {\n    openingSelection = editor.selection.getBookmark();\n    displayDialogue(editor);\n};\n\nexport const initInstructionGif = () => {\n    const gif = window.document.getElementById('eduInstructionGif');\n    if (gif === null) {\n        return;\n    }\n    const relativePath = gif.getAttribute('src');\n    const absolutePath = Config.wwwroot + relativePath;\n    gif.setAttribute('src', absolutePath);\n};\n\nconst handleInsertSubmission = async(editor) => {\n    const nodeJson = window.document.getElementById('edusharing_node').value;\n    const node = JSON.parse(nodeJson);\n    const version = window.document.querySelector('input[name=\"eduVersion\"]:checked').value;\n    const caption = window.document.getElementById('captionInput').value;\n    const alignment = window.document.querySelector('input[name=\"eduAlignment\"]:checked').value;\n    const width = window.document.getElementById('eduWidth').value;\n    const height = window.document.getElementById('eduHeight').value;\n    let style = '';\n    if (alignment !== 'none') {\n        style = 'float:' + alignment + ';';\n    }\n    if (node.mediatype === 'folder') {\n        style = 'display:block;';\n    }\n\n    let title = node.title || node.name;\n\n    let url = new URL(node.previewUrl);\n    url.searchParams.set('caption', caption);\n    url.searchParams.set('object_url', node.objectUrl);\n    url.searchParams.set('mediatype', node.mediatype);\n    url.searchParams.set('mimetype', node.mimetype);\n    url.searchParams.set('window_version', version);\n    url.searchParams.set('title', title);\n\n    let img = false;\n    let ref = false;\n\n    if (node.mediatype === 'ref') {\n        ref = true;\n    } else {\n        img = true;\n        url.searchParams.set('width', width.toString());\n        url.searchParams.set('height', height.toString());\n    }\n\n    const content = await renderForPromise(`${component}/content`, {\n        edusharingImg: img,\n        edusharingRef: ref,\n        edusharingPreviewSrc: url.toString(),\n        edusharingTitle: title.toString(),\n        edusharingInsertCaption: caption.toString() !== \"\",\n        edusharingCaption: caption.toString(),\n        edusharingWidth: width.toString(),\n        edusharingHeight: height.toString(),\n        edusharingStyle: style,\n        dataEdited: false\n    });\n\n    editor.selection.moveToBookmark(openingSelection);\n    editor.execCommand('mceInsertContent', false, content.html);\n    editor.selection.moveToBookmark(openingSelection);\n};\n\nconst displayDialogue = async(editor) => {\n    const prepareEditModal = () => {\n        const addEditSubmitHandler = () => {\n            $root.on(ModalEvents.save, () => {\n                const newCaption = window.document.getElementById('captionInput').value;\n                const inputAlignment = window.document.querySelector('input[name=\"eduAlignment\"]:checked').value;\n                const hasAlignmentChanged = inputAlignment !== alignment;\n                const inputWidth = parseInt(window.document.getElementById('eduWidth').value);\n                const inputHeight = parseInt(window.document.getElementById('eduHeight').value);\n                let hasSizeChanged = inputHeight !== height || inputWidth !== width;\n                if (isSizeEditable && hasSizeChanged) {\n                    url.searchParams.set('width', inputWidth);\n                    url.searchParams.set('height', inputHeight);\n                }\n                if (!isOldAttoElement) {\n                    if (existingCaption === null && newCaption !== \"\") {\n                        const newCaptionParagraph = document.createElement('p');\n                        newCaptionParagraph.classList.add('edusharing_caption');\n                        newCaptionParagraph.innerHTML = newCaption;\n                        currentEdusharing.appendChild(newCaptionParagraph);\n                    } else if (existingCaption !== null && newCaption !== \"\") {\n                        existingCaptionParagraph.remove();\n                    } else {\n                        existingCaption.innerHTML = newCaption;\n                    }\n                    if (hasAlignmentChanged) {\n                        if (inputAlignment === 'none') {\n                            currentEdusharing.style.removeProperty('float');\n                            currentEdusharing.setAttribute('data-mce-style', \"\");\n                        } else {\n                            currentEdusharing.style.float = inputAlignment;\n                            currentEdusharing.setAttribute('data-mce-style', 'float: ' + inputAlignment + ';');\n                        }\n                    }\n                    if (isSizeEditable && hasSizeChanged) {\n                        eduImage.setAttribute('width', inputWidth);\n                        eduImage.setAttribute('height', inputHeight);\n                    }\n                    if (hasAlignmentChanged || hasSizeChanged) {\n                        eduImage.setAttribute('src', url.toString());\n                        eduImage.setAttribute('data-edited', 1);\n                    }\n                } else {\n                    let style = '';\n                    if (inputAlignment !== 'none') {\n                        style = 'float:' + inputAlignment + ';';\n                    }\n                    if (url.searchParams.get('mediatype') === 'folder') {\n                        style = 'display:block;';\n                    }\n                    renderForPromise(`${component}/content`, {\n                        edusharingImg: true,\n                        edusharingRef: false,\n                        edusharingPreviewSrc: url.toString(),\n                        edusharingTitle: url.searchParams.get('title'),\n                        edusharingInsertCaption: window.document.getElementById('captionInput').value !== \"\",\n                        edusharingCaption: window.document.getElementById('captionInput').value,\n                        edusharingWidth: inputWidth.toString(),\n                        edusharingHeight: inputHeight.toString(),\n                        edusharingStyle: style,\n                        dataEdited: hasAlignmentChanged || hasSizeChanged\n                    }).then(result => {\n                        currentEdusharing.remove();\n                        if (paragraphToRemove !== null) {\n                            paragraphToRemove.remove();\n                            const nextParagraph = paragraphToRemove.nextSibling;\n                            if (nextParagraph !== null && nextParagraph.nodeName === 'P'\n                                && nextParagraph.hasChildNodes() && nextParagraph.firstChild.nodeName === 'BR'\n                                && nextParagraph.innerText === \"\") {\n                                nextParagraph.remove();\n                            }\n                        }\n                        editor.selection.moveToBookmark(openingSelection);\n                        editor.insertContent(result.html);\n                        editor.selection.moveToBookmark(openingSelection);\n                        return false;\n                    }).catch(error => window.console.log(error));\n                }\n            });\n        };\n        let existingCaption = null;\n        const nodeOptionsForm = window.document.getElementById('nodeOptionsForm');\n        const existingCaptionParagraph = currentEdusharing.querySelector('.edusharing_caption');\n        let paragraphToRemove = null;\n        if (isOldAttoElement) {\n            const nextSibling = currentEdusharing.nextSibling;\n            if (nextSibling !== null && nextSibling.nodeName === 'P' && nextSibling.innerText !== \"\") {\n                window.document.getElementById('eduCaptionText').innerHTML = nextSibling.innerText;\n                window.document.getElementById('eduAttoCaptionPrompt').classList.remove('d-none');\n                window.document.getElementById('eduCaptionContinueButton').classList.remove('d-none');\n                window.document.getElementById('eduSubmitButton').classList.add('d-none');\n                nodeOptionsForm.classList.add('d-none');\n                window.document.getElementById('eduCaptionContinueButton').addEventListener(\"click\", () => {\n                    const useExistingCaption = window.document.querySelector('input[name=\"eduCaption\"]:checked').value === '0';\n                    paragraphToRemove = useExistingCaption ? nextSibling : null;\n                    if (useExistingCaption) {\n                        window.document.getElementById('captionInput').value = nextSibling.innerText;\n                        existingCaption = nextSibling.innerText;\n                    }\n                    nodeOptionsForm.classList.remove('d-none');\n                    window.document.getElementById('eduAttoCaptionPrompt').classList.add('d-none');\n                    window.document.getElementById('eduCaptionContinueButton').classList.add('d-none');\n                    window.document.getElementById('eduSubmitButton').classList.remove('d-none');\n                });\n            } else {\n                nodeOptionsForm.classList.remove('d-none');\n            }\n        } else {\n            if (existingCaptionParagraph !== null) {\n                window.document.getElementById('captionInput').value = existingCaptionParagraph.innerHTML;\n                existingCaption = existingCaptionParagraph.innerHTML;\n            }\n            nodeOptionsForm.classList.remove('d-none');\n        }\n        const submitButton = window.document.getElementById('eduSubmitButton');\n        submitButton.disabled = false;\n        submitButton.innerHTML = submitButton.getAttribute('data-secondary-title');\n        let isSizeEditable = true;\n        const modalTitle = root.querySelector('.modal-title');\n        modalTitle.innerHTML = modalTitle.querySelector('input').value;\n        window.document.getElementById('repoButtonContainer').classList.add('d-none');\n        const eduImage = currentEdusharing.querySelector(\"img.edusharing_atto\");\n        if (eduImage === null || eduImage === undefined) {\n            root.querySelector('.mform').classList.add('d-none');\n            root.getElementById('eduNoEditInfo').classList.remove('d-none');\n            root.getElementById('eduSubmitButton').classList.add('d-none');\n            return;\n        }\n        const objectUrl = eduImage.getAttribute('src');\n        window.document.getElementById('eduPreviewImage').setAttribute('src', objectUrl);\n        let url = new URL(objectUrl);\n        const mediaType = url.searchParams.get('mediatype');\n        let width = 600;\n        let height = 400;\n        if (!hideSizeOptions(mediaType)) {\n            width = parseInt(eduImage.getAttribute('width') ?? 600);\n            height = parseInt(eduImage.getAttribute('height') ?? 400);\n            initSizeCalculation(width, height);\n        } else {\n            isSizeEditable = false;\n        }\n        window.document.querySelectorAll(\".eduVersionRadio\").forEach(item => item.classList.add('d-none'));\n        window.document.getElementById('eduContentTitle').innerHTML = url.searchParams.get('title');\n        let alignment = currentEdusharing.style.float === \"\" ? 'none' : currentEdusharing.style.float;\n        if (alignment === \"none\" && isOldAttoElement) {\n            alignment = currentEdusharing.style.textAlign === \"\" ? 'none' : currentEdusharing.style.textAlign;\n        }\n        if (alignment !== 'none') {\n            window.document.getElementById('eduAlignment' + (alignment === 'right' ? '2' : '1')).checked = true;\n        }\n        addEditSubmitHandler();\n    };\n    const prepareInsertModal = () => {\n        root.addEventListener('click', (e) => {\n            const openRepoButton = e.target.closest('[data-target=\"edusharing\"]');\n            if (openRepoButton) {\n                const repoUrl = getRepoUrl(editor);\n                openRepo(repoUrl, getRepoTarget(editor), getCourseId(editor));\n                window.addEventListener(\"message\", applyNodeListener);\n            }\n        });\n        const applyNodeListener = event => {\n            if (event.data.event === \"APPLY_NODE\") {\n                const node = event.data.data;\n                const width = node.properties['ccm:width'] !== undefined ? Math.round(node.properties['ccm:width'][0]) : 600;\n                const height = node.properties['ccm:height'] !== undefined ? Math.round(node.properties['ccm:height'][0]) : 400;\n                window.win.close();\n                checkVersioning(node);\n                window.document.getElementById('repoButtonContainer').classList.add('d-none');\n                window.document.getElementById('nodeOptionsForm').classList.remove('d-none');\n                window.document.getElementById('eduContentTitle').innerHTML = node.name ?? node.title;\n                window.document.getElementById('eduPreviewImage')\n                    .setAttribute('src', node.preview.url);\n                hideSizeOptions(node.mediatype);\n                hideCaptionInput(node.mediatype);\n                initSizeCalculation(width, height);\n                setNodeData(node);\n                window.document.getElementById('eduSubmitButton').disabled = false;\n            }\n        };\n    };\n    const selection = editor.selection.getNode();\n    let currentEdusharing = selection.closest('.edusharing-placeholder');\n    let isOldAttoElement = false;\n    if (currentEdusharing === null) {\n        if (selection.nodeName === 'IMG' && selection.classList.contains('edusharing_atto')) {\n            const parent = selection.parentNode;\n            if (parent.nodeName === 'P') {\n                currentEdusharing = parent;\n                isOldAttoElement = true;\n            }\n        } else if (selection.nodeName === 'P') {\n            const firstChild = selection.firstChild;\n            if (firstChild.nodeName === 'IMG' && firstChild.classList.contains('edusharing_atto')) {\n                currentEdusharing = selection;\n                isOldAttoElement = true;\n            }\n        }\n    }\n    const isEditMode = currentEdusharing !== null;\n    const modal = await ModalFactory.create({\n        type: Modal.TYPE,\n        large: true,\n        removeOnClose: true\n    });\n    modal.show();\n    const $root = modal.getRoot();\n    const root = $root[0];\n    if (isEditMode) {\n        prepareEditModal();\n    } else {\n        prepareInsertModal();\n        $root.on(ModalEvents.save, () => {\n            handleInsertSubmission(editor);\n        });\n    }\n};\n\nconst hideSizeOptions = mediaType => {\n    const mediaTypesWithoutSizeChoice = ['file-word', 'file-pdf', 'file-odt', 'file-audio', 'file-pdf', 'link'];\n    if (mediaTypesWithoutSizeChoice.includes(mediaType)) {\n        window.document.getElementById('eduWidthContainer').classList.add('d-none');\n        return true;\n    }\n    return false;\n};\n\nconst hideCaptionInput = mediaType => {\n    if (mediaType === \"ref\") {\n        window.document.getElementById(\"eduCaptionContainer\").classList.add('d-none');\n    }\n};\n\nconst initSizeCalculation = (width, height) => {\n    if (width === 0 || height === 0) {\n        return;\n    }\n    const aspectRatio = width / height;\n    const heightInput = window.document.getElementById('eduHeight');\n    const widthInput = window.document.getElementById('eduWidth');\n    widthInput.value = width;\n    heightInput.value = height;\n    widthInput.addEventListener('keyup', event => recalculateDimensions(event));\n    widthInput.addEventListener('change', event => recalculateDimensions(event));\n    heightInput.addEventListener('keyup', event => recalculateDimensions(event));\n    heightInput.addEventListener('change', event => recalculateDimensions(event));\n    const recalculateDimensions = (event) => {\n        if (event.target.id === 'eduHeight') {\n            widthInput.value = Math.round(heightInput.value * aspectRatio);\n        } else {\n            heightInput.value = Math.round(widthInput.value / aspectRatio);\n        }\n    };\n};\n\nconst checkVersioning = (node) => {\n    const hasVersion = node.properties['cclom:version'] !== undefined;\n    if (node.aspects.includes('ccm:published') || node.aspects.includes('ccm:collection_io_reference') || !hasVersion) {\n        window.document.querySelectorAll(\".eduVersionRadio\")\n            .forEach(item => item.classList.add('d-none'));\n    }\n    if (hasVersion) {\n        window.document.getElementById('eduversion2').value = node.properties['cclom:version'][0];\n    }\n};\n\nconst setNodeData = node => {\n    const nodeData = {\n        mimetype: node.mimetype,\n        mediatype: node.mediatype,\n        title: node.title,\n        objectUrl: node.objectUrl,\n        name: node.name,\n        previewUrl: node.preview.url\n    };\n    window.document.getElementById('edusharing_node').value = JSON.stringify(nodeData);\n};\n\nconst openRepo = (repoUrl, repoTarget, courseId) => {\n    window.win = window.open();\n    window.win.document.write('Loading edu-sharing ticket...');\n    switch (repoTarget) {\n        case 'collections':\n            repoTarget = '/components/collections';\n            break;\n        case 'workspace':\n            repoTarget = '/components/workspace/files';\n            break;\n        default:\n            repoTarget = '/components/search';\n    }\n    const ajaxParams = {\n        eduTicketStructure: {\n            courseId: courseId\n        }\n    };\n    getTicket(ajaxParams)\n        .then(response => {\n            repoUrl += repoTarget + '?reurl=WINDOW&applyDirectories=true&ticket=' + response.ticket;\n            window.win.location.href = repoUrl;\n            return null;\n        })\n        .fail(() => window.document.write('Error loading ticket.'));\n};\n"],"names":["openingSelection","editor","selection","getBookmark","displayDialogue","gif","window","document","getElementById","relativePath","getAttribute","absolutePath","Config","wwwroot","setAttribute","async","getNode","currentEdusharing","closest","isOldAttoElement","nodeName","classList","contains","parent","parentNode","firstChild","isEditMode","modal","ModalFactory","create","type","Modal","TYPE","large","removeOnClose","show","$root","getRoot","root","existingCaption","nodeOptionsForm","existingCaptionParagraph","querySelector","paragraphToRemove","nextSibling","innerText","innerHTML","remove","add","addEventListener","useExistingCaption","value","submitButton","disabled","isSizeEditable","modalTitle","eduImage","objectUrl","url","URL","mediaType","searchParams","get","width","height","hideSizeOptions","parseInt","initSizeCalculation","querySelectorAll","forEach","item","alignment","style","float","textAlign","checked","on","ModalEvents","save","newCaption","inputAlignment","hasAlignmentChanged","inputWidth","inputHeight","hasSizeChanged","set","component","edusharingImg","edusharingRef","edusharingPreviewSrc","toString","edusharingTitle","edusharingInsertCaption","edusharingCaption","edusharingWidth","edusharingHeight","edusharingStyle","dataEdited","then","result","nextParagraph","hasChildNodes","moveToBookmark","insertContent","html","catch","error","console","log","newCaptionParagraph","createElement","appendChild","removeProperty","prepareEditModal","e","target","repoUrl","openRepo","applyNodeListener","event","data","node","undefined","properties","Math","round","win","close","checkVersioning","name","title","preview","mediatype","hideCaptionInput","setNodeData","prepareInsertModal","nodeJson","JSON","parse","version","caption","previewUrl","mimetype","img","ref","content","execCommand","handleInsertSubmission","includes","aspectRatio","heightInput","widthInput","recalculateDimensions","id","hasVersion","aspects","nodeData","stringify","repoTarget","courseId","open","write","ajaxParams","eduTicketStructure","response","ticket","location","href","fail"],"mappings":"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"}